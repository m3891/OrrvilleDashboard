<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Orrville Display</title>

<style>
:root {
  --theme: 0;
  --ui-scale: 1.4;
}

:root {
  --bg: color-mix(in srgb,
    #f5f6f8 calc((1 - var(--theme)) * 100%),
    #0b0b0d calc(var(--theme) * 100%)
  );
  --card: color-mix(in srgb,
    rgba(255,255,255,0.85) calc((1 - var(--theme)) * 100%),
    rgba(28,28,30,0.9) calc(var(--theme) * 100%)
  );
  --text: color-mix(in srgb,
    #111 calc((1 - var(--theme)) * 100%),
    #fff calc(var(--theme) * 100%)
  );
  --muted: color-mix(in srgb,
    rgba(0,0,0,0.65) calc((1 - var(--theme)) * 100%),
    rgba(255,255,255,0.65) calc(var(--theme) * 100%)
  );
  --alert: #ff453a;
}

html, body {
  margin: 0;
  width: 100vw;
  height: 100vh;
  background: var(--bg);
  color: var(--text);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  overflow: hidden;
}

.main {
  display: grid;
  grid-template-columns: 1fr 1.3fr 1fr;
  gap: 2%;
  padding: 2%;
  height: 100%;
  box-sizing: border-box;
  align-content: stretch;
}

.column {
  display: flex;
  flex-direction: column;
  gap: 2%;
  flex-grow: 1;
  justify-content: space-evenly;
}

.card {
  background: var(--card);
  border-radius: 2vw;
  padding: 1.5%;
  backdrop-filter: blur(1vw);
  box-shadow: 0 1vw 2vw rgba(0,0,0,0.12);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  flex-grow: 1; /* evenly distribute vertical space */
}

.imageFrame {
  width: 100%;
  aspect-ratio: 16 / 9;
  overflow: hidden;
  border-radius: 1.5vw;
  display: flex;
  align-items: center;
  justify-content: center;
}

.imageFrame img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.city {
  font-size: calc(4rem * var(--ui-scale));
  font-weight: 700;
}

.time {
  font-size: calc(6rem * var(--ui-scale));
  font-weight: 800;
  margin-top: 10px;
}

.date {
  font-size: calc(2rem * var(--ui-scale));
  color: var(--muted);
  margin-top: 10px;
}

.big {
  font-size: calc(3rem * var(--ui-scale));
  font-weight: 700;
}

#sunriseTime,
#sunsetTime {
  font-size: calc(1.5rem * var(--ui-scale));
  font-weight: 600;
}

.sunLabel {
  font-size: calc(2rem * var(--ui-scale));
  font-weight: 600;
  color: var(--muted);
}

.sunTime {
  font-size: calc(2.4rem * var(--ui-scale));
  font-weight: 700;
  margin-top: 0.3em;
}

#forecast3 {
  font-size: calc(1.5rem * var(--ui-scale)); /* 3-Day Forecast Font Size */
  font-weight: 600;
}

.sunEvent {
  text-align: center;
}

#temp {
  font-size: calc(3.6rem * var(--ui-scale));
}

.alert {
  color: var(--alert);
  font-weight: 700;
  font-size: calc(1.7rem * var(--ui-scale)); /* adjust 2rem as desired */
}

.card.image-card {
  padding: 0;
  overflow: hidden;
  border-radius: 2vw;

  /* ðŸ”‘ limit size so it canâ€™t take over */
  max-height: 22vh;
  height: 22vh;
}

.card.image-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}


/* Ensure other images fit within cards */
img {
  max-width: 100%;
  height: auto;
  border-radius: 1.5vw;
}
</style>
</head>

<body>

<div class="main">

  <!-- LEFT COLUMN -->
  <div class="column">
<div style="display:grid; grid-template-columns: 1fr 1fr; gap: 2%;">
<div class="card">
  <div class="sunLabel">Sunrise</div>
  <div class="sunTime" id="sunriseTime">â€”</div>
</div>

<div class="card">
  <div class="sunLabel">Sunset</div>
  <div class="sunTime" id="sunsetTime">â€”</div>
</div>
</div>

    <div class="card">
      <div id="forecast3">---</div>
    </div>

<div class="card image-card">
  <img
    id="radarImg"
    src="https://radar.weather.gov/ridge/standard/KCLE_loop.gif"
    alt="Weather Radar">
</div>
  </div>

  <!-- CENTER COLUMN -->
  <div class="column">
    <div class="card">
      <div class="big" id="temp">--Â°F</div>
      <div id="forecast">---</div>
    </div>

    <div class="card">
      <div class="city">Orrville, OH</div>
      <div class="time" id="localTime"></div>
      <div class="date" id="localDate"></div>
    </div>

    <div class="card">
      <div class="big" id="moonPhase">â€”</div>
    </div>
  </div>

  <!-- RIGHT COLUMN -->
  <div class="column">
    <div class="card">
      <div class="big" id="utcTime"></div>
    </div>

    <div class="card">
      <div id="alerts">Checkingâ€¦</div>
    </div>

<div class="card image-card">
  <img
    id="trafficCam"
    src="https://itscameras.dot.state.oh.us/images/D03/US-30_SR-57.jpg"
    alt="Traffic Camera">
</div>

  </div>

</div>

<script>
const LAT = 40.789;
const LON = -81.760;
const radarImg   = document.getElementById("radarImg");
const trafficCam = document.getElementById("trafficCam");
const alerts     = document.getElementById("alerts");
const sunriseTime = document.getElementById("sunriseTime");
const sunsetTime  = document.getElementById("sunsetTime");

function updateTime() {
  const now = new Date();
  localTime.textContent = now.toLocaleTimeString([], { hour:'numeric', minute:'2-digit' });
  localDate.textContent = now.toLocaleDateString([], { weekday:'long', month:'long', day:'numeric' });
  utcTime.textContent = now.toISOString().substring(11,16) + " UTC";
}
updateTime();
setInterval(updateTime, 1000);

async function fetchWeather() {
  const res = await fetch(
    `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}` +
    `&current_weather=true` +
    `&daily=temperature_2m_max,temperature_2m_min,weathercode,sunrise,sunset` +
    `&timezone=America/New_York`
  );
  const data = await res.json();

  temp.textContent = Math.round(data.current_weather.temperature * 9/5 + 32) + "Â°F";
  forecast.textContent = weatherCodeToText(data.current_weather.weathercode);

  forecast3.innerHTML = data.daily.time.slice(1,4).map((d,i) => {
    const hi = Math.round(data.daily.temperature_2m_max[i+1]*9/5+32);
    const lo = Math.round(data.daily.temperature_2m_min[i+1]*9/5+32);
    return `${new Date(d).toLocaleDateString([], {weekday:'short'})}: ${hi}Â° / ${lo}Â°`;
  }).join("<br>");

const rise = new Date(data.daily.sunrise[0]).toLocaleTimeString([], {
  hour: 'numeric',
  minute: '2-digit'
});
const set = new Date(data.daily.sunset[0]).toLocaleTimeString([], {
  hour: 'numeric',
  minute: '2-digit'
});

sunriseTime.textContent = rise;
sunsetTime.textContent  = set;

}

async function fetchAlerts() {
  try {
    const res = await fetch(
      `https://api.weather.gov/alerts/active?point=${LAT},${LON}`,
      { headers:{ Accept:"application/geo+json" } }
    );
    const data = await res.json();
if (data.features?.length) {
  alerts.innerHTML = data.features
    .map(f => `<span class="alert">${f.properties.event}</span>`)
    .join("<br>");
} else {
  alerts.textContent = "No Active Weather Alerts";
}
  } catch {
    alerts.textContent = "No Active Weather Alerts";
  }
}

function refreshRadar() {
  if (!radarImg) return;
  radarImg.src = "";
  radarImg.src =
    "https://radar.weather.gov/ridge/standard/KCLE_loop.gif?ts=" + Date.now();
}

function refreshCam() {
  const img = document.getElementById("trafficCam");
  if (!img) return;

  // Force reload even if the browser cached an error frame
  img.src = "";
  img.src =
    "https://itscameras.dot.state.oh.us/images/D03/US-30_SR-57.jpg?ts=" + Date.now();
}

function updateMoonPhase() {
  const synodicMonth = 29.53058867;
  const knownNewMoon = new Date(Date.UTC(2000,0,6,18,14));
  const days = (Date.now() - knownNewMoon) / 86400000;
  const phase = (days % synodicMonth) / synodicMonth;

  const phases = [
    "New Moon","Waxing Crescent","First Quarter","Waxing Gibbous",
    "Full Moon","Waning Gibbous","Last Quarter","Waning Crescent"
  ];

  moonPhase.textContent = phases[Math.floor(phase * 8) % 8];
}

function weatherCodeToText(c) {
  return {
    0:"Clear Sky",1:"Mostly Clear",2:"Partly Cloudy",3:"Overcast",
    61:"Rain",71:"Snow",95:"Thunderstorms"
  }[c] ?? "â€”";
}

fetchWeather();
fetchAlerts();
updateMoonPhase();

setInterval(fetchWeather, 10 * 60 * 1000);
setInterval(fetchAlerts, 10 * 60 * 1000);
setInterval(updateMoonPhase, 60 * 60 * 1000);
setInterval(refreshRadar, 5 * 60 * 1000); // radar every 5 min
setInterval(refreshCam,   2 * 60 * 1000); // camera every 2 min
setTimeout(() => location.reload(), 24 * 60 * 60 * 1000);
</script>

</body>
</html>
